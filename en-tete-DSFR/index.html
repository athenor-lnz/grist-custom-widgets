<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>G√©n√©rateur d‚Äôen-t√™te DSFR</title>

  <!-- DSFR CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/utility/utilities.min.css">

  <style>
    body { background: white; margin: 0; padding: 1rem; }
    .fr-container { max-width: 800px; }
    .fr-header, .fr-header__brand { filter: none !important; --hover: transparent; }
    .codebox { width: 100%; min-height: 250px; font-family: monospace; }
    #operator-section { display: none; } /* Cach√© par d√©faut */
    .note { font-size: 0.9rem; color: #666; margin-top: 1rem; }
  </style>
</head>
<body>

  <div class="fr-container">
    <h2 class="fr-h3">G√©n√©rateur d‚Äôen-t√™te DSFR</h2>
    <p class="fr-text--sm">
      Remplissez les champs ci-dessous, pr√©visualisez le rendu, puis g√©n√©rez le code HTML statique √† copier.
      <br><br>
      <strong>üí° Conseil :</strong> le code g√©n√©r√© est con√ßu pour √™tre coll√© directement dans la configuration du
      <em>Custom Widget Builder</em> du d√©veloppeur <strong>berhalak</strong> sur <a href="https://grist.numerique.gouv.fr" target="_blank">grist.numerique.gouv.fr</a>.
    </p>

    <form id="config-form" class="fr-my-3w">
      <div class="fr-select-group fr-mb-3w">
        <label class="fr-label" for="intitule">Bloc marque</label>
        <select id="intitule" class="fr-select" required>
          <option value="">‚Äî S√©lectionner ‚Äî</option>
        </select>
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="nomService">Nom du service</label>
        <input id="nomService" class="fr-input" type="text" placeholder="">
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="baseline">Baseline (sous-titre)</label>
        <input id="baseline" class="fr-input" type="text" placeholder="">
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="logoUrl">Logo (URL, facultatif)</label>
        <input id="logoUrl" class="fr-input" type="url" placeholder="https://exemple.com/logo.png">
      </div>

      <div class="fr-btns-group fr-btns-group--right">
        <button type="button" id="btn-preview" class="fr-btn">Pr√©visualisez</button>
        <button type="button" id="btn-generate" class="fr-btn fr-btn--secondary">G√©n√©rez le HTML final</button>
        <button type="button" id="btn-reset" class="fr-btn fr-btn--tertiary">R√©initialisez</button>
      </div>
    </form>

    <div id="preview" style="display:none;" class="fr-mb-4w">
      <header role="banner" class="fr-header">
        <div class="fr-header__body">
          <div class="fr-container">
            <div class="fr-header__body-row">
              <div class="fr-header__brand fr-enlarge-link">
                <div class="fr-header__brand-top">
                  <div class="fr-header__logo">
                    <p class="fr-logo" id="intitule-officiel">R√©publique<br>Fran√ßaise</p>
                  </div>
                  <div class="fr-header__operator" id="operator-section">
                    <img id="logo-img" class="fr-responsive-img" style="max-width: 9rem;" alt="Logo">
                  </div>
                </div>
                <div class="fr-header__service">
                  <p class="fr-header__service-title" id="nom-service"></p>
                  <p class="fr-header__service-tagline" id="baseline-text"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
    </div>

    <div id="result-block" style="display:none;">
      <h4 class="fr-h4">Code HTML g√©n√©r√©</h4>
      <textarea id="export-code" class="fr-input codebox" readonly></textarea>
      <div class="fr-btns-group fr-mt-2w">
        <button type="button" id="btn-copy" class="fr-btn">Copier</button>
        <button type="button" id="btn-download" class="fr-btn fr-btn--secondary">T√©l√©charger</button>
      </div>
      <p class="note">
        üí° Collez ce code dans le <strong>Custom Widget Builder</strong> de <strong>berhalak</strong> pour l‚Äôutiliser dans un widget Grist.
      </p>
    </div>
  </div>

  <!-- DSFR JS -->
  <script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.module.min.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.nomodule.min.js" nomodule></script>

  <script>
    const cesuresAdmin = {
      "R√©publique fran√ßaise": "R√©publique<br>Fran√ßaise",
      "Premier ministre": "Premier<br>ministre",
      "Minist√®re de l‚ÄôInt√©rieur": "Minist√®re<br>de l‚ÄôInt√©rieur",
      "Minist√®re des Arm√©es": "Minist√®re<br>des Arm√©es",
      "Minist√®re de la Justice": "Minist√®re<br>de la Justice",
      "Minist√®re de la Culture": "Minist√®re<br>de la Culture",
      "Minist√®re de l‚Äô√âconomie et des Finances": "Minist√®re<br>de l‚Äô√âconomie<br>et des Finances",
      "Minist√®re de la Transition √©cologique et solidaire": "Minist√®re<br>de la Transition<br>√©cologique et solidaire",
      "Minist√®re des Solidarit√©s et de la Sant√©": "Minist√®re<br>des Solidarit√©s<br>et de la Sant√©",
      "Minist√®re de l‚Äô√âducation nationale et de la Jeunesse": "Minist√®re<br>de l‚Äô√âducation<br>nationale et de la Jeunesse",
      "Minist√®re des Sports": "Minist√®re<br>des Sports",
      "Minist√®re des Outre-mer": "Minist√®re<br>des Outre-mer",
      "Minist√®re de la Coh√©sion des territoires": "Minist√®re<br>de la Coh√©sion<br>des territoires",
      "Minist√®re de l‚ÄôAgriculture et de l‚ÄôAlimentation": "Minist√®re<br>de l‚ÄôAgriculture<br>et de l‚ÄôAlimentation"
    };

    document.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('intitule');
      Object.keys(cesuresAdmin).forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        select.appendChild(option);
      });
    });

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
      }[m]));
    }

    function applyPreview({ intitule, nomService, baseline, logoUrl }) {
      const intElem = document.getElementById('intitule-officiel');
      const nomElem = document.getElementById('nom-service');
      const baseElem = document.getElementById('baseline-text');
      const opSec = document.getElementById('operator-section');
      const logo = document.getElementById('logo-img');

      intElem.innerHTML = cesuresAdmin[intitule] || intitule || 'R√©publique<br>Fran√ßaise';
      nomElem.textContent = nomService || '';
      baseElem.textContent = baseline || '';

      if (logoUrl && logoUrl.trim() !== '') {
        logo.src = logoUrl;
        opSec.style.display = 'block';
      } else {
        logo.removeAttribute('src');
        opSec.style.display = 'none';
      }

      document.getElementById('preview').style.display = 'block';
    }

    function buildFinalHtml({ intitule, nomService, baseline, logoUrl }) {
      const marque = cesuresAdmin[intitule] || intitule || 'R√©publique<br>Fran√ßaise';
      const opBlock = logoUrl
        ? `<div class="fr-header__operator"><img class="fr-responsive-img" style="max-width:9rem;" src="${logoUrl}" alt="Logo"></div>`
        : '';
      return `<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.min.css">
<style>body{margin:0;background:#fff;}.fr-header,.fr-header__brand{filter:none!important;}</style>
</head>
<body>
<header role="banner" class="fr-header"><div class="fr-header__body"><div class="fr-container"><div class="fr-header__body-row"><div class="fr-header__brand fr-enlarge-link"><div class="fr-header__brand-top"><div class="fr-header__logo"><p class="fr-logo">${marque}</p></div>${opBlock}</div><div class="fr-header__service"><p class="fr-header__service-title">${escapeHtml(nomService)}</p><p class="fr-header__service-tagline">${escapeHtml(baseline)}</p></div></div></div></div></div></header></body></html>`;
    }

    function getData() {
      return {
        intitule: document.getElementById('intitule').value,
        nomService: document.getElementById('nomService').value,
        baseline: document.getElementById('baseline').value,
        logoUrl: document.getElementById('logoUrl').value
      };
    }

    document.getElementById('btn-preview').addEventListener('click', () => {
      const data = getData();
      applyPreview(data);
      document.getElementById('result-block').style.display = 'none';
    });

    document.getElementById('btn-generate').addEventListener('click', () => {
      const data = getData();
      applyPreview(data);
      const html = buildFinalHtml(data);
      document.getElementById('export-code').value = html;
      document.getElementById('result-block').style.display = 'block';
    });

    document.getElementById('btn-copy').addEventListener('click', async () => {
      await navigator.clipboard.writeText(document.getElementById('export-code').value);
      alert('‚úÖ Code copi√© dans le presse-papiers');
    });

    document.getElementById('btn-download').addEventListener('click', () => {
      const html = document.getElementById('export-code').value;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'header-dsfr.html';
      a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      document.getElementById('config-form').reset();
      document.getElementById('preview').style.display = 'none';
      document.getElementById('result-block').style.display = 'none';
    });
  </script>
</body>
</html>
