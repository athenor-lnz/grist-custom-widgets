<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Générateur d’en-tête DSFR</title>

  <!-- DSFR CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/utility/utilities.min.css">

  <style>
    body { background: white; margin: 0; padding: 1rem; }
    .fr-container { max-width: 800px; }
    .fr-header, .fr-header__brand { filter: none !important; --hover: transparent; }
    .codebox { width: 100%; min-height: 250px; font-family: monospace; }
    #operator-section { display: none; } /* Caché par défaut */
  </style>
</head>
<body>

  <div class="fr-container">
    <h2 class="fr-h3">Générateur d’en-tête DSFR</h2>
    <p class="fr-text--sm">Remplis les champs ci-dessous, prévisualise, puis génère le code HTML statique à copier.</p>

    <form id="config-form" class="fr-my-3w">
      <div class="fr-select-group fr-mb-3w">
        <label class="fr-label" for="intitule">Bloc marque</label>
        <select id="intitule" class="fr-select" required>
          <option value="">— Sélectionner —</option>
        </select>
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="nomService">Nom du service</label>
        <input id="nomService" class="fr-input" type="text" placeholder="ex : Gendarmerie nationale">
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="baseline">Baseline (sous-titre)</label>
        <input id="baseline" class="fr-input" type="text" placeholder="ex : Groupement III/6">
      </div>

      <div class="fr-input-group fr-mb-3w">
        <label class="fr-label" for="logoUrl">Logo (URL, facultatif)</label>
        <input id="logoUrl" class="fr-input" type="url" placeholder="https://exemple.com/logo.png">
      </div>

      <div class="fr-btns-group fr-btns-group--right">
        <button type="button" id="btn-preview" class="fr-btn">Prévisualiser</button>
        <button type="button" id="btn-generate" class="fr-btn fr-btn--secondary">Générer le HTML final</button>
        <button type="button" id="btn-reset" class="fr-btn fr-btn--tertiary">Réinitialiser</button>
      </div>
    </form>

    <div id="preview" style="display:none;" class="fr-mb-4w">
      <header role="banner" class="fr-header">
        <div class="fr-header__body">
          <div class="fr-container">
            <div class="fr-header__body-row">
              <div class="fr-header__brand fr-enlarge-link">
                <div class="fr-header__brand-top">
                  <div class="fr-header__logo">
                    <p class="fr-logo" id="intitule-officiel">République<br>Française</p>
                  </div>
                  <div class="fr-header__operator" id="operator-section">
                    <img id="logo-img" class="fr-responsive-img" style="max-width: 9rem;" alt="Logo">
                  </div>
                </div>
                <div class="fr-header__service">
                  <p class="fr-header__service-title" id="nom-service"></p>
                  <p class="fr-header__service-tagline" id="baseline-text"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
    </div>

    <div id="result-block" style="display:none;">
      <h4 class="fr-h4">Code HTML généré</h4>
      <textarea id="export-code" class="fr-input codebox" readonly></textarea>
      <div class="fr-btns-group fr-mt-2w">
        <button type="button" id="btn-copy" class="fr-btn">Copier</button>
        <button type="button" id="btn-download" class="fr-btn fr-btn--secondary">Télécharger</button>
      </div>
    </div>
  </div>

  <!-- DSFR JS -->
  <script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.module.min.js" type="module"></script>
  <script src="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.nomodule.min.js" nomodule></script>

  <script>
    const cesuresAdmin = {
      "République française": "République<br>Française",
      "Premier ministre": "Premier<br>ministre",
      "Ministère de l’Intérieur": "Ministère<br>de l’Intérieur",
      "Ministère des Armées": "Ministère<br>des Armées",
      "Ministère de la Justice": "Ministère<br>de la Justice",
      "Ministère de la Culture": "Ministère<br>de la Culture",
      "Ministère de l’Économie et des Finances": "Ministère<br>de l’Économie<br>et des Finances",
      "Ministère de la Transition écologique et solidaire": "Ministère<br>de la Transition<br>écologique et solidaire",
      "Ministère des Solidarités et de la Santé": "Ministère<br>des Solidarités<br>et de la Santé",
      "Ministère de l’Éducation nationale et de la Jeunesse": "Ministère<br>de l’Éducation<br>nationale et de la Jeunesse",
      "Ministère des Sports": "Ministère<br>des Sports",
      "Ministère des Outre-mer": "Ministère<br>des Outre-mer",
      "Ministère de la Cohésion des territoires": "Ministère<br>de la Cohésion<br>des territoires",
      "Ministère de l’Agriculture et de l’Alimentation": "Ministère<br>de l’Agriculture<br>et de l’Alimentation"
    };

    document.addEventListener('DOMContentLoaded', () => {
      const select = document.getElementById('intitule');
      Object.keys(cesuresAdmin).forEach(key => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        select.appendChild(option);
      });
    });

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
      }[m]));
    }

    function applyPreview({ intitule, nomService, baseline, logoUrl }) {
      const intElem = document.getElementById('intitule-officiel');
      const nomElem = document.getElementById('nom-service');
      const baseElem = document.getElementById('baseline-text');
      const opSec = document.getElementById('operator-section');
      const logo = document.getElementById('logo-img');

      intElem.innerHTML = cesuresAdmin[intitule] || intitule || 'République<br>Française';
      nomElem.textContent = nomService || '';
      baseElem.textContent = baseline || '';

      if (logoUrl && logoUrl.trim() !== '') {
        logo.src = logoUrl;
        opSec.style.display = 'block';
      } else {
        logo.removeAttribute('src');
        opSec.style.display = 'none';
      }

      document.getElementById('preview').style.display = 'block';
    }

    function buildFinalHtml({ intitule, nomService, baseline, logoUrl }) {
      const marque = cesuresAdmin[intitule] || intitule || 'République<br>Française';
      const opBlock = logoUrl
        ? `<div class="fr-header__operator"><img class="fr-responsive-img" style="max-width:9rem;" src="${logoUrl}" alt="Logo"></div>`
        : '';
      return `<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@gouvfr/dsfr@1.13.1/dist/dsfr/dsfr.min.css">
<style>body{margin:0;background:#fff;}.fr-header,.fr-header__brand{filter:none!important;}</style>
</head>
<body>
<header role="banner" class="fr-header"><div class="fr-header__body"><div class="fr-container"><div class="fr-header__body-row"><div class="fr-header__brand fr-enlarge-link"><div class="fr-header__brand-top"><div class="fr-header__logo"><p class="fr-logo">${marque}</p></div>${opBlock}</div><div class="fr-header__service"><p class="fr-header__service-title">${escapeHtml(nomService)}</p><p class="fr-header__service-tagline">${escapeHtml(baseline)}</p></div></div></div></div></div></header></body></html>`;
    }

    function getData() {
      return {
        intitule: document.getElementById('intitule').value,
        nomService: document.getElementById('nomService').value,
        baseline: document.getElementById('baseline').value,
        logoUrl: document.getElementById('logoUrl').value
      };
    }

    document.getElementById('btn-preview').addEventListener('click', () => {
      const data = getData();
      applyPreview(data);
      document.getElementById('result-block').style.display = 'none';
    });

    document.getElementById('btn-generate').addEventListener('click', () => {
      const data = getData();
      applyPreview(data);
      const html = buildFinalHtml(data);
      document.getElementById('export-code').value = html;
      document.getElementById('result-block').style.display = 'block';
    });

    document.getElementById('btn-copy').addEventListener('click', async () => {
      await navigator.clipboard.writeText(document.getElementById('export-code').value);
      alert('✅ Code copié dans le presse-papiers');
    });

    document.getElementById('btn-download').addEventListener('click', () => {
      const html = document.getElementById('export-code').value;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'header-dsfr.html';
      a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      document.getElementById('config-form').reset();
      document.getElementById('preview').style.display = 'none';
      document.getElementById('result-block').style.display = 'none';
    });
  </script>
</body>
</html>
